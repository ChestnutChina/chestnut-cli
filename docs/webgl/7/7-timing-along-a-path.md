## 沿路径计时

假设您使用参数方程在动画的一系列帧上更改对象的位置和方向。参数参数 t 的值需要在包含运动的帧上从 0.0 变化到 1.0。本课讨论如何计算适当的 t 值。

### 速度和加速度

速度定义为距离除以时间。对于汽车，我们使用英里/小时；对于一个跑步的人来说，也许是米/秒。距离、时间和速度使用以下基本公式相互关联：

```js
speed = distance / time;
distance = speed * time;
time = distance / speed;
```

当你设计一个动画时，你必须在三个值中选择两个，第三个值“就是它是什么”。所以你有 3 个场景来设计动画：

1. 您决定旅行的距离和旅行的时间。
2. 你决定移动的速度和旅行的时间。
3. 你决定旅行的距离和速度。

选项 1 可能是最常见的，这就是我们将在本课中讨论的内容。

对于动画，您可以以秒或帧为单位测量时间。可以使用与您的虚拟场景一致的任何单位来测量距离。请记住，WebGL 是无单位的；您只需要对所有测量使用一致的单位。

加速度是速度随时间的变化。当你加速时，你正在增加你的速度。当你减速时，你正在降低你的速度。在现实世界中，您不能立即开始以特定速度行驶，也不能立即停止。任何开始移动的物体都必须加速到给定的速度，以该速度行进一定的时间，然后减速直到物体静止。这在图中可视化。

当我们创建虚拟世界时，我们经常对运动做出简化的假设。让我们考虑两种情况：

- 我们完全忽略加速度。
- 我们包括加速度，但将其建模为线性变化。

<center>
  <img src='/7/acceleration.png' />
</center>

### 忽略加速度

对于简单的运动，有时可以忽略加速度并立即开始以恒定速度运动。对于参数参数 t，如果您的 t 值之间的差异相等，则您的位置变化将是一个恒定的距离，这意味着您将以恒定的速度移动。要计算此类运动的“t 变化”，只需计算对象在运动期间将具有的离散位置的数量。然后将其除以 1.0，因为 t 在 0.0 和 1.0 之间变化。 （请注意，给定 n 个帧，帧之间有 (n-1) 个转换。）

```js
number_frames = ending_frame - starting_frame + 1;
dt = 1.0 / (number_frames-1);
```

让我们来看一个具体的例子。在第 100 帧中，对象是静止的，并且位置为 p1 = (10, 12,-4)。您希望对象在第 110 帧之前移动到位置 p2 = (20, 8, 5)。在第 101 到 109 帧中，对象将位于由参数方程计算的位置。使用上述等式，dt 的值为 0.1，每帧的 t 值为：

<center>
  <img src='/7/eq2.png' />
</center>

开始和结束帧的选择决定了动画的时间。您可以通过除以帧速率将帧数转换为秒。例如：

```js
seconds = (number_frames-1) / (30 frames/ 1 sec);
```

起点和终点的选择决定了运动的距离。您可以使用距离公式计算确切的距离：
```js
distance = Math.sqrt( (p2x-p1x)*(p2x-p1x) + (p2y-p1y)*(p2y-p1y) + (p2z-p1z)*(p2z-p1z));
```

如果我们需要精确的运动速度，我们可以计算它：
```js
speed = distance / seconds;
```

### 包括加速

对于更逼真的运动，您需要包括对象开始移动时的加速度和减速停止时的减速度。这增加了动画设计和计算的复杂性。

<center>
  <img src='/7/acceleration_simplified.png' />
</center>

为了尽可能简化我们的计算，我们将加速度和减速度视为如图所示的线性函数。我们可以考虑很多场景，但让我们看一个简单的场景，动画设计师决定加速和减速所需的时间。将使用我们上面使用的简单示例来开发方程：在第 100 帧中，对象是静止的，并且位置为 p1 = (10, 12,-4)；您希望对象在第 110 帧之前移动到位置 p2 = (20, 8, 5)；运动开始时加速需要 3 帧，运动结束时减速需要 2 帧。下表列出了我们需要计算的值的场景。请注意，为了计算 t 的实际值，我们需要计算帧之间的“t 变化”。我们最终会得到 11 个 t 值，但有 10 个“t 值变化”。

<center>
  <img src='/7/eq3.png' />
</center>

我们称“t 中的变化”为 dt。如果 dt 是恒定的，那么我们就有恒定的速度。如果 dt 增加，我们有加速度；如果 dt 减小，我们就会减速。我们使用加速线和减速线的斜率来近似运动开始和结束时的 dt 值。我们不知道 dt 的值，但我们知道所有值的总和必须为 1.0。对于图中的具体例子，我们可以写出下面的等式。在图中，框架用垂直的红线标记。请注意，我们在每一帧的中间取 dt 的值。

```js
// Adding the dt values for acceleration, constant speed, and deceleration
1.0 = 1/6*dt + 3/6*dt + 5/6*dt + dt + dt + dt + dt + dt + 3/4*dt + 1/4*dt;
```

<center>
  <img src='/7/acceleration_example.png' />
</center>

因此 7.5*dt === 1.0 并且 dt 必须是 1/7.5 或 0.133。将 dt 的这个值代入每个项中，可以得到每个帧的特定“t 变化”。这些值显示在下表中。

<center>
  <img src='/7/eq4.png' />
</center>

让我们对计算值进行一些观察：

- 对于这个问题，dt 值为 0.133，而对于原始“恒速”问题，dt 值为 0.1。有意义的是，恒定运动过程中的速度必须更大，以弥补在加速和减速过程中损失的时间。
- dt 值在加速过程中增加，在减速过程中减小。希望这从物理角度也有意义。

通过一些工作，我们可以将该算法推广到任何一组输入。下面演示代码中的函数 calculateAnimation 将根据起始帧、结束帧、要加速的帧数和要减速的帧数计算并返回一个 t 值数组。请仔细研究代码。然后用 WebGL 演示程序进行试验。

点击查看[交互式例子](http://learnwebgl.brown37.net/07_cameras/timing_along_a_path.html#include-acceleration)

[在新的标签或窗口中打开这个webgl程序](http://learnwebgl.brown37.net/07_cameras/points_along_a_path/points_along_a_path.html)

### 总结

您可以使用使用单个输入 t 指定中间值的参数方程来更改对象的位置、方向和可能的其他属性。如果我们正确地改变 t，我们可以模拟加速、恒速和减速。计算t值的场景主要有3种，根据指定距离和时间，需要计算速度，或者指定距离和速度，需要计算时间，或者指定速度和时间，需要计算距离。在上面的示例中，我们指定了距离和时间，这需要我们计算速度（即 dt 值）。除了我们在这里讨论的两种情况之外，还有许多其他可能的情况。