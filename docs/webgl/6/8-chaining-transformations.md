## 链式转换

上一课演示了矩阵变换的初始化和使用。本课将演示如何将变换链接在一起以产生复杂的运动。

### 机械臂 - 前臂

之前的演示渲染了一个表示机器人手臂底部的对象。让我们在底座上添加一个“前臂”连杆。前臂将围绕底座中的红色销轴旋转。为了使前臂旋转，它的旋转轴需要在原点，所以我们在 Blender 中设计模型，并将红色销钉穿过前臂的位置放在原点。这将适用于您创建的所有模型。您对它们进行设计，以便它们可以轻松地围绕其本地原点进行缩放和旋转。然后可以将模型移动到场景中的所需位置。

<center>
<img src='/6/forearm.png' />
</center>

对于前臂，我们希望它围绕底座中的红色销轴旋转。由于旋转始终围绕轴进行，因此需要先进行旋转。然后可以将手臂移动到销钉的位置。使用从右到左的转换顺序，我们有：

```html
                 ┌                ┐   ┌               ┐  Eq1
modelTransform = │ translateToPin │ * | rotateForearm |
                 └                ┘   └               ┘
```

可是等等。底座在旋转。所以我们不能简单地将前臂移到底座上。发生在底座上的相同旋转需要发生在前臂上。所以我们也将基本旋转应用到前臂，但在它已经旋转和平移之后。所以我们的 modelTransform 看起来像这样：

```html
                 ┌              ┐   ┌                ┐   ┌               ┐ Eq2
modelTransform = │ baseRotation │ * | translateToPin | * | rotateForearm |
                 └              ┘   └                ┘   └               ┘
```

### 场景渲染初始化

下面的演示程序是上一课代码的修改版本。它为机器人手臂添加了一个前臂模型。我们需要两个新的变换矩阵来操纵前臂。一次变换将围绕底座的销旋转手臂。旋转可能会在每个新帧上发生变化，因此该矩阵将在初始化代码中创建，但在帧渲染函数中分配其值。平移矩阵可以创建并赋值一次，因为到枢轴销的距离是恒定的并且永远不会改变。研究示例代码，然后查看下面的代码描述。如果您想进行实验，演示代码是可修改的。

点击查看[交互式例子](http://learnwebgl.brown37.net/transformations2/transformations_example2.html#scene-rendering-initialization)

[在新的标签或窗口中打开这个webgl程序](http://learnwebgl.brown37.net/transformations2/simple_transform_example2/simple_transform_example2.html)

关于执行构造函数代码时发生的预处理操作：

| 行数 | 说明 |
| -- | -- |
| 60-61 | 创建了两个新的变换来操纵前臂。 |
| 64 | 前臂的平移被设置为沿Y方向恒定的2个单位。 |
| 74 | 我们创建了一个类变量来存储前臂的角度。它是公开的，所以HTML滑块事件处理程序可以改变其值。 |
| 153 | 在GPU中的缓冲对象被创建，模型数据被复制到GPU中的前臂模型。 |

### 渲染单帧

每次需要对场景进行渲染时，都会调用第79-103行的渲染函数。这个函数与以前的演示版本相同，但有以下例外:

| 行数 | 说明 |
| -- | -- |
| 96 | 设置前臂的旋转矩阵是因为前臂的旋转可以在每一帧上改变。 |
| 99-100 | 计算前臂的变换。请注意，包括基本旋转。还要注意从右到左的变换顺序。转换的顺序很关键。 |
| 103 | 使用计算的变换来渲染前臂模型。 |