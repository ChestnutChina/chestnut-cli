## 链式转换 - 添加上臂

上一课展示了一个带有一个连杆机构的机械臂。本课将演示如何将变换链接在一起以添加第二个链接

### 机械臂 - 上臂

我们机器人的上臂是在 Blender 中创建的，其局部原点设置为 (0,0,0)，以便可以轻松旋转。它的旋转轴是 Z 轴。检查上臂的图像。

<center>
<img src='/6/upperarm.png' />
</center>

上臂将围绕前臂末端转动。但是旋转是关于原点的。我们需要将上臂绕原点旋转，然后将其移动到前臂的末端。但是前臂和底座都在旋转。那么我们如何将上臂放到正确的位置呢？我们使用定位前臂的变换！这是我们需要应用到上臂的变换，顺序如下：

1. 将其围绕其红色销旋转到所需的角度。
2. 将其翻译到前臂的末端。
3. 根据前臂的角度旋转它。
4. 把它翻译成底座的红色别针。
5. 根据底座的旋转角度旋转它。

上臂的变换需要如下：


```html
                 ┌              ┐   ┌                ┐   ┌               ┐   ┌                       ┐   ┌                ┐ Eq1
modelTransform = │ baseRotation │ * | translateToPin | * | rotateForearm | * | translateToForearmEnd | * | rotateUpperarm |
                 └              ┘   └                ┘   └               ┘   └                       ┘   └                ┘
```

希望你在这里看到一个模式！

### 场景渲染初始化

下面的演示程序是上一课代码的修改版本。它为机器人手臂增加了一个“上臂”模型。我们需要两个新的变换矩阵来操纵上臂。一次变换将围绕其枢轴销旋转手臂。旋转可能会在每个新帧上发生变化，因此该矩阵将在初始化代码中创建，但在帧渲染函数中分配其值。平移矩阵可以创建并赋值一次，因为到前臂末端的距离是一个常数并且永远不会改变。研究示例代码，然后查看下面的代码描述。如果您想进行实验，演示代码是可修改的。

点击查看[交互式例子](http://learnwebgl.brown37.net/transformations2/transformations_example3.html#scene-rendering-initialization)

[在新的标签或窗口中打开这个webgl程序](http://learnwebgl.brown37.net/transformations2/simple_transform_example3/simple_transform_example3.html)

关于执行构造函数代码时发生的预处理操作：

| 行数 | 说明 |
| -- | -- |
| 62-63 | 创建了两个新的变换来操纵上臂。 |
| 67 | 上臂的平移设置为沿 Y 的恒定 8 个单位。|
| 78 | 创建一个类变量来存储上臂的角度。它是公开的，因此 HTML 滑块事件处理程序可以更改其值。 |
| 169 | 在 GPU 中创建缓冲区对象，并将模型数据复制到 GPU 用于上臂模型。 |

### 渲染单帧

每次场景需要渲染时，都会调用第 83-117 行的渲染函数。此功能与之前的演示版本相同，但有以下例外：

| 行数 | 说明 |
| -- | -- |
| 110 | 设置上臂的旋转矩阵是因为前臂的旋转可以在每一帧上改变。 |
| 113-114 | 计算上臂的变换。请注意，包括基本旋转和前臂变换。还要注意从右到左的变换顺序。转换的顺序很关键。 |
| 117 | 使用计算的变换来渲染上臂模型。 |