## 光线衰减

光的一个基本特性是，它离光源越远，它的强度就越低。这就是为什么金星和水星比地球热得多，而火星比地球冷得多。来自太阳的光的强度与到太阳的距离成比例地变化。其技术名称是[光衰减](https://en.wikipedia.org/wiki/Attenuation)。

### 光衰减

光从光源传播得越远越弱。在物理世界中，衰减与$1/{d^2}$成正比，其中 d 是光源和物体之间的距离。使用函数$1/{d^2}$会导致光迅速减少，因此通常使衰减与$1/{d^2}$成正比。请注意，如果 d 大于 1，则两个方程都会计算 0.0 和 1.0 之间的分数。衰减只是计算用于为像素着色的原始光的百分比。

下面的示例片段着色器代码执行以下任务：

- 计算从片段位置到光源的向量。
- 计算向量的长度，即到光源的距离。
- 计算衰减量。 （对于本例，使用函数 10.0 / d。）
- 将衰减限制在 0% 和 100% 之间的百分比。 （对于方程 10.0 / d，任何距离小于 10 个单位的物体都将接收到全光，而距离超过 10 个单位的物体将接收不到全光。显然，10 的值是任意的，并且会根据特定应用程序的需要而变化。 )
- 片段的最终颜色是其计算颜色的百分比。

```js
to_light = u_Light_position - v_Vertex;
d = length( to_light );
attenuation = clamp( 10.0 / d, 0.0, 1.0);
// ...
color = attenuation * (ambient_color + diffuse_color + specular_color);
```

如果你想要一个可以在运行时改变的衰减因子，你可以使衰减方程中的常数成为一个统一的变量，在运行时分配一个值。然而，对一个场景中的不同模型使用不同的衰减值是不常见的。

在最初的OpenGL照明模型中，方程式 ${1.0/(c1 + c2 * d + c3 * d^2)}$ 被用来给程序员控制衰减。你可以设置c1、c2和c3的值，以创造大量可能的衰减函数。由于引入了可编程着色器，你可以实现确切的衰减功能，以满足你的应用程序的需要。

在文献中，你通常看到像10.0/d这样的衰减方程，分母中的比例常数是这样写的：1.0 / 0.1 * d。你用这两个方程得到的结果是一样的，但也许其中一个方程对你来说更直观。

如果你不希望衰减在离光源一定距离时突然 "启动"，你可以在分母上加一个一，以保证分母总是大于分子。这样就不需要上述例子中的箝制功能了，而且在与光源的任何距离上都能提供平滑的衰减。你可以在下面的衰减函数 ${1.0/(c1 + c2 * d + c3 * d^2)}$  的图中尝试各种常数c1和c2的值。

点击查看[交互式例子](http://learnwebgl.brown37.net/09_lights/lights_attenuation.html#id1)

### 总结

你是否注意到，所有的照明和色彩计算都是百分比！这是很重要的。