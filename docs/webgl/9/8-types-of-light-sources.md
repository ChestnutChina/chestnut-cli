## 光源的类型

在第9.1课中，我们讨论了各种类型的光源。让我们在这里重复一下这个清单，以便复习。

- 点光源。光线在场景内的一个特定位置，它向所有方向平等地照射光线。一个例子是一盏台灯。点光源是用一个单一的位置（x,y,z,1）来建模的。
- 太阳光源。光线在场景外，而且足够远，所有光线基本上都来自同一个方向。一个例子是户外场景中的太阳。太阳光源被建模为一个单一的矢量，\<dx, dy, dz, 0>，它定义了光线的方向。
- 聚光灯光源。光线被聚焦，并在从光源投射出去时形成一个圆锥状的包络。一个例子是剧院里的聚光灯。聚光灯被建模为一个位置，(x,y,z,1)，一个方向，\<dx.dy,dz,0>，一个锥体角度，以及一个定义聚光灯锥体内光线密度的指数。
- 区域光源。光源来自一个矩形区域，从矩形的一侧投射光线。一个例子是天花板上的荧光灯具。区域光源被建模为一个矩形，（4个顶点），和一个方向，\<dx.dy,dz,0>。

我们在第9.2-9.5课讨论的所有照明计算都使用了点光源。本课讨论了实现其他类型的光源所需的修改。

### 太阳光源

太阳光源的位置离场景很远。如果你计算一个从场景中的顶点到光源位置的向量，你每次都会得到相同的向量（假设是有限精度的浮点数学）。因此，太阳光源的位置被建模为一个指向太阳的单一向量。你的JavaScript程序应该对矢量进行归一化处理，这样就不需要碎片着色器对其进行归一化处理了--这使得碎片着色器的执行速度加快。你的JavaScript代码还必须将太阳光的方向转换成 "相机空间"，因为照明计算是在 "相机空间 "中进行的。在渲染开始之前，光照方向向量会作为一个统一的变量被复制到着色器程序中。

将太阳光的方向作为 "通往光源的矢量"，所有环境光、漫反射和镜面光的计算都保持不变。

太阳光源离场景非常远，它与场景中的所有顶点的距离基本相同。因此，你通常不会实现光的衰减。

### 聚光灯光源

聚光灯光源在场景中有一个位置，但它的光线被限制在一个特定的方向。为了确定聚光灯的光线是否到达了某个片段，你可以进行以下计算:
- 计算一个从聚光灯位置到片段的向量。(让我们把这个矢量称为to_frag）。
- 计算to_frag向量与聚光灯方向向量之间的角度。
- 如果这个角度小于或等于聚光灯的圆锥角，那么这个片段就接受了聚光灯的光。如果这个角度大于聚光灯的圆锥角，那么这个片段就没有接收到聚光灯的任何光线。

一旦你确定一个片段正在接受光线，你就可以像我们之前讨论的那样计算漫反射和镜面光。如果这个片段没有接受来自聚光灯的光线，那么这个片段接受的唯一颜色就是来自环境光。

要注意你计算的矢量的方向，确保它们彼此一致。例如，如果你计算一个从片段到聚光灯的矢量，这个矢量的方向将与聚光灯的方向相反，你将计算出错误的角度。

聚光灯内的光线强度通常不均匀。圆锥体中心的强度最大，边缘的强度最小。你可以使用一个余弦函数，像我们为镜面反射所做的那样，把余弦函数提高到一个幂数，来模拟锥体内部的不同强度的光线

<center>
  <img src="/9/spotlight.png" />
</center>

### 区域光源

一个区域光源是办公室天花板上的典型照明模式。光线来自一个矩形区域，并向下投射到房间里。这种类型的光源与点光源的主要区别是，光的位置不是唯一的。有多种方法可以让你建立一个区域灯的模型。下面是一种方法:

- 确定该碎片是否在接收光线的区域光的一侧。如果不是，就只使用环境光。否则，继续。
- 将一个片段的位置投射到包含区域光矩形的平面上。
- 确定投射点是否在矩形内。
- 如果投射点在矩形内，就用这个位置作为光源的位置。
- 如果投射点在矩形之外，则使用矩形边界上最近的点作为光源。

一旦你有了光源的位置，你就可以进行漫反射和镜面反射的计算。

你可以将光线建模为向单一方向投射，或根据指定的角度从边界向外扩散。你可以使计算变得简单或复杂，只要你想。通常，模型越复杂，视觉效果越好。

### 场景中的多个光源

一个典型的场景有多个光源。在这种情况下，你要对每个光源进行我们之前所描述的计算，然后简单地将得到的颜色加起来。光是加法的!

如果你有光源在场景动画中的不同时间被打开和关闭，你有两个基本选择。

- 在你的着色器程序中包含一个统一的布尔变量，可以启用或禁用某个特定光源的照明计算。
- 定义多个着色器程序，并为每种照明情况使用适当的着色器程序。

在着色器程序中使用if语句会降低其执行速度。如果渲染速度是一个问题，你应该为每种可能的光照情况使用单独的着色器程序。如果渲染速度不是一个问题，你应该使用一个带有布尔标志的单一着色器程序来控制光照的计算。