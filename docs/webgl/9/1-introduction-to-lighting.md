## 照明介绍

你的眼睛 "看到 "一个物体，是因为光从该物体上反射到你的眼睛。没有光，任何东西都是看不见的。

本课讨论了反射光的基本特性和用于计算反射光的数学方法。

### 光的特性回顾

请重新阅读第3.8课--[灯光造型](../3/8-light-modeling.md)。

你真的重读了第3.8课吗。如果没有，请现在就读。这很重要!

### 光源类型

有许多不同的光源。四个常用的描述光源的模型是:
- 点光源。光线在场景内的一个特定位置，它向所有方向平等地照射光线。一个例子是一盏台灯。点光源是用一个单一的位置（x,y,z,1）来建模的。
- 太阳光源。该光源在场景之外，距离足够远，所有光线基本上都来自同一个方向。一个例子是户外场景中的太阳。太阳光源被建模为一个单一的矢量，\<dx, dy, dz, 0>，它定义了光束的方向。
- 聚光灯光源。光线被聚焦，并在从光源投射出去时形成一个圆锥状的包络。一个例子是剧院里的聚光灯。聚光灯的模型是一个位置，(x,y,z,1)，一个方向，\<dx.dy,dz,0>，一个锥体角度，以及一个定义聚光灯锥体内部光线密度的指数。
- 区域光源。光源来自于一个矩形区域，从矩形的一侧投射光线。一个例子是天花板上的荧光灯具。区域光源被建模为一个矩形，（4个顶点），和一个方向，\<dx.dy,dz,0>。

所有这些模型都有一个共同的属性：光线的传播方向。在下面的课程中，我们将讨论如何利用光的方向来计算面部各个像素的颜色

### 光的颜色

来自台灯或太阳的光通常是白色的阴影。然而，有些光源不是白色的，例如红色的停车灯、蓝色的霓虹灯或体育赛事中的紫色聚光灯。当我们为一个光源建模时，我们用RGB颜色值来指定它的颜色。如果一个光源发出白光，我们将其颜色建模为（1.0, 1.0, 1.0）。如果光源发出红光，我们将其颜色建模为（1.0, 0.0, 0,0）。

当你看到一个红色物体时，你看到的是物体表面反射光的红色成分；光的绿色和蓝色成分被物体的表面吸收了。红色物体吸收了除红色波长以外的所有波长的光。这个事实意味着，如果你用蓝光照射红色物体，你看到的是黑色的！所有的蓝光都被吸收了。所有的蓝光都被物体的表面吸收了。物体的颜色和其表面反射的光线之间的相互作用是我们将建立的一个重要的视觉效果。

### 计算光反射

要计算光反射，我们需要知道三个东西的位置和方向：

- 被渲染的对象，
- 光源，和
- 相机。

场景渲染具有一个相机、一个或多个光源以及一个或多个对象。渲染对象所需的数据存储在 GPU 缓冲区对象中。相机和灯光所需的数据必须在渲染开始之前复制到 GPU。我们希望尽可能高效地进行渲染的设置和初始化。考虑对模型顶点进行的三个基本变换，如下图所示。

<center>
  <img src="/9/when_to_calculate.png" />
</center>

让我们考虑哪些物体的几何值可以用于照明计算。

1. 原始位置：这是对象的原始定义。它不代表特定场景中对象的位置或方向。我们不能将这些值用于照明计算。
2. 场景中的位置：这是对象在模型变换后的位置和方向。这会相对于场景中的其他对象放置对象的位置和方向。假设我们知道光源和相机的位置和方向，我们可以使用这些值执行准确的光反射计算。
3. 相机前面的位置：这是一个对象在被视图变换变换后的位置和方向。这保留了场景中对象的相对位置和方向。假设我们知道光源的位置和方向，我们可以使用这些值进行准确的光反射计算。请注意，对于这些几何值，相机位于原点，其局部坐标系与全局坐标系对齐。这样做的好处是我们不必将相机的位置和方向发送到着色器程序，因为我们知道相机的确切位置。
4. 裁剪体积内的位置：几何值已通过投影变换进行变换，可以进行裁剪。 x 和 y 值的含义已与每个几何顶点的 z 值分离。顶点与场景中的其他 3D 位置不再具有相同的相对关系。 （请记住，透视变换将 z 值非线性映射到裁剪体积。）我们不能使用这些值进行精确的照明计算。

因此，我们有两个可能的“3D 空间”来执行准确的光照计算。 “相机空间”具有明显的优势，因为相机处于已知的位置和方向，我们不必将其位置和方向传递给 GPU 着色器程序。并且相机位于全局原点的事实简化了一些光反射计算。

为了完成所有这些工作，您必须在 JavaScript 程序中创建两个单独的转换矩阵，并将它们都传递给您的着色器程序。这个变换矩阵：

```html
┌                  ┐   ┌            ┐   ┌              ┐   ┌   ┐   ┌    ┐ Eq1
│ ProjectionMatrix │ * | ViewMatrix | * |  ModelMatrix | * | x |   | x' |
└                  ┘   └            ┘   └              ┘   | y | = | y' | 
                                                           | z |   | z' |
                                                           | w |   | w' |
                                                           └   ┘   └    ┘
```

将执行图形管道所需的所有转换，而此转换矩阵将为照明计算生成有效的位置和方向。
```html
┌            ┐   ┌              ┐   ┌   ┐   ┌    ┐ Eq1
| ViewMatrix | * |  ModelMatrix | * | x |   | x' |
└            ┘   └              ┘   | y | = | y' | 
                                    | z |   | z' |
                                    | w |   | w' |
                                    └   ┘   └    ┘
```

### 光照算法

为了渲染使用光照计算为像素着色的场景，我们执行以下算法：

1. 在你的 JavaScript 程序中:
    1. 使用模型和相机转换将光源置于正确的位置和方向。
    2. 将光源的位置和方向传输到 GPU 的着色器程序
    3. 创建一个包含所需投影矩阵的附加变换矩阵。
    4. 将两个变换矩阵传输到 GPU 的着色器程序；一个用于光照计算，另一个用于渲染计算。
2. 在您的 GPU 着色器程序中:
    1. 假设相机位于从 -Z 轴向下看的全局原点。
    2. 使用光源数据和模型数据计算光反射。
    3. 根据光反射为像素分配颜色。

### 课程组织

以下有关照明的课程描述了如何实现点光源并遵循此总体大纲：
- 引入“照明模型”。
- 解释计算“照明模型”所需的数学。
- 提供实现“光照模型”的WebGL演示程序。使用演示程序进行实验以了解“照明模型”的视觉效果非常重要。
- 解释实现“光照模型”的着色器程序的细节。

如果您了解如何为点光源实现照明，您应该能够将这些想法扩展到其他类型的灯光，例如太阳、聚光灯和区域灯光。

细节可能是压倒性的，所以在继续下一个更复杂的照明模型之前，请花点时间掌握每个照明模型。