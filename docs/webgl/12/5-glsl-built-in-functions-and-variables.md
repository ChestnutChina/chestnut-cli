## GLSL内置函数和变量

### 内置函数
GLSL 提供了大量的内置函数，您应该熟悉它们。这些功能的完整列表可在此快速参考卡的第四页找到。请注意以下有关功能的内容。

- 大多数函数仅适用于浮点标量或向量。它们不适用于整数或布尔值。例外是一组接受布尔和整数输入并返回布尔值的“向量关系函数”。
- 这些函数被重载以接受各种输入并返回相同数据类型的结果。例如，考虑函数原型 T sin(T angle)，其中 T 表示数据类型 float、vec2、vec3 或 vec4。这代表了 sin 函数的四个版本。每个版本都执行一个分量正弦计算，并返回一个与其输入大小相同的结果。
    ```js
    float function sin(float angle);
    vec2  function sin(vec2 angles);
    vec3  function sin(vec3 angles);
    vec4  function sin(vec4 angles);
    ```

请查看快速参考卡第四页的[内置函数列表](http://learnwebgl.brown37.net/12_shader_language/documents/webgl-reference-card-1_0.pdf)。

### 内置变量

着色器程序使用预定义的输入和输出变量与图形管道通信。

### 顶点着色器的输出

顶点着色器有两个输出：

- gl_Position：顶点在“剪辑坐标”中的 vec4 位置。剪辑坐标在第 8 节中有详细描述

  - x 和 y 的值在 [-1.0,+1.0] 范围内，表示顶点在查看窗口中的位置。
  - z 值在 [-1.0,+1.0] 范围内，表示顶点到相机的距离。
  - 正交投影的 w 值为 1.0，或者 w 值是透视投影的透视除值。
  - 剪裁立方体外的任何顶点都被剪裁到立方体的边界。

- gl_PointSize：用于渲染点的像素数。它是一个浮点值，可以有小数部分。它只适用于单点的渲染，不适用于线条和三角形的顶点。如果未指定值，则其默认值为 1.0。

图形管线使用顶点着色器的输出来确定查看窗口中构成图形基元的像素（即片段）。图形管道中的光栅化器为每个像素创建一个片段，计算任何可变变量的插值，并为以下片段着色器输入值设置值。

### 片段着色器的输入

- gl_FragCoord：一个 vec4 值，保存片段的 (x,y,z,w) 值。这是 gl_Position 在经过视口变换和透视分割后的值。因此，(x,y) 值是要渲染的图像中片段的位置。 z 值是与相机的距离。请注意，这些是浮点值，并且 (x,y) 值是像素的中心。例如，左下角像素的 (x,y) 值为 (0.5, 0.5)。
- gl_FrontFacing：一个布尔值，如果此片段是正面图元的一部分，则为真。这仅适用于三角形。如果三角形的法线向量指向相机，则三角形为“正面”。法线向量是根据三角形的顶点计算的，顶点的逆时针排序将产生一个“正面”法线向量。
- gl_PointCoord：是一个 vec2 值，其 (x,y) 值在 [0.0,1.0] 范围内。这些值指示该片段在点的渲染中的相对位置。点的总大小（以像素为单位）来自 gl_PointSize 输出变量。点渲染的坐标系原点是覆盖该点的正方形的左上角。 （这只适用于渲染点 gl.POINTS。渲染 gl.LINES 和 gl.TRIANGLES 时未定义。）

### 片段着色器的输出

WebGL 片段着色器有一个输出——片段的颜色值。

- gl_FragColor ：一个 RGBA (vec4) 值，它被放置在它正在处理的片段的颜色缓冲区中。

OpenGL 支持渲染到多个颜色缓冲区以创建高级视觉效果。将颜色写入 gl_FragData[n] 允许片段着色器创建多个图像，这些图像可以“合成”到单个最终渲染中。 WebGL 1.0 不支持不使用扩展的多个颜色缓冲区，因此我们不会在这里讨论它们。