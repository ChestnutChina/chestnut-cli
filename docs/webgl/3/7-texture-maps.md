## 纹理贴图

现实世界中的物体表面很少是纯色的。我们需要一种方法来为一个表面上的多种颜色建模。纹理贴图使我们能够做到这一点。让我们从贴图的概念开始。

### 什么是映射？

在数学中，映射是一个将一组输入转换为输出值的函数。有两种基本方式可以做到这一点：

- 对输入进行计算，产生输出值。
- 从一个可能的值的列表中查找输出值。这被称为 "表格查找"。

映射的输出往往是某种图案，所以在计算机图形学中，由于形成的图案，我们把输入到输出的转换称为纹理图。

纹理图允许我们为模型面部的每个像素分配不同的颜色。

### 程序化纹理图

程序性纹理图是一个利用计算将输入值转换为颜色的函数。计算的结果可以用来选择一种颜色，也可以用计算的值来创造一种颜色。对于可以计算的可能模式的数量没有限制。下面的例子产生了一个10像素宽的黑白棋盘图案。
```js
function checkerboard(x,y) {
  if ( floor(x/10) + floor(y/10) mod 2 == 1) {
    color = [ 0, 0, 0, 1]; // black
  } else {
    color = [ 1, 1, 1, 1]; // white
  }
  return color;
}
```
输入值可以是任何你想基于的着色。一维纹理贴图需要一个单一的输入值并返回一种颜色。二维纹理贴图需要两个输入值并返回一种颜色。三维纹理贴图需要三个输入值并返回一种颜色。你会明白的。

### 图像纹理贴图

"查表 "纹理映射通常使用图像来完成。一个图像是一个颜色值的二维数组。给定一个行和列的值，返回图像中某个特定位置的像素的颜色是很简单的。在伪代码中，这样的纹理映射看起来像这样：
```js
function getColor(image, x, y) {
  return image[x][y]; // the color of the indicated pixel
}
```

图像是为模型脸指定一组颜色值的方便方法，因为有许多工具可以使图像处理变得简单，例如[gimp](https://www.gimp.org/)。然而，图像总是矩形的，而WebGL只渲染三角形。我们需要一种方法来指定图像中哪些像素包含三角形面的颜色。

"纹理坐标 "指定图像中哪个位置对应于三角形的顶点。为了使纹理坐标适用于任何图像，这些位置是以百分比来指定的。例如，0.0是图像的左边缘，1.0是右边缘，而0.5是中间位置。左边的图像显示了一个例子。顶点B被映射到图像中的一个特定位置，其纹理坐标为（0.31，0.74），因为我们想在顶点B显示的图像中的颜色距离左边缘31%，距离底部边缘74%。一旦这三个三维顶点被映射到图像中的相应位置，内部位置就可以很容易地被计算出来。

<center>
<img src='/3/texture_coordinate_example.jpg'>
<p>用作纹理贴图的图像(1)</p>
</center>

请注意，如果一个三维三角形的比例与图像上的面积不成正比，那么三维三角形上显示的 "图片 "就会被扭曲。指派不扭曲图像的纹理坐标是很难手工完成的。像Blender这样的工具对创建适当的纹理坐标大有帮助。

### WebGL 实现

WebGL同时支持程序性和基于图像的纹理映射。

- 程序性纹理映射是通过在你的片段着色器中写函数来完成的。
- 基于图像的纹理映射是通过以下方式进行的：
    - 从服务器上下载一个合适的图像。
    - 创建一个GPU纹理对象并将图像保存到GPU的内存中。
    - 在你的片段着色器中使用一个表格查询功能，从图像中获取特定像素的颜色。

关于纹理映射的更多实施细节将在第11节中介绍。