## 灯光建模

要建立一个物体在现实世界中的外观模型，你必须建立光与物体表面的互动模型。当光线照射到物体上时，会发生以下四种情况中的一种或多种。

- 光线反射并向不同的方向飞去。反射光的方向是由面的表面特性决定的。
- 光线被物体吸收并转化为能量，随着时间的推移使物体升温。(这就是所谓的[吸收](https://en.wikipedia.org/wiki/Absorption_(electromagnetic_radiation))）。
- 光线穿过物体并继续前进，但以不同的轨迹前进。(光线穿过物体被称为[透明](https://en.wikipedia.org/wiki/Transparency_and_translucency)，方向的改变被称为[折射](https://en.wikipedia.org/wiki/Refraction)）。
- 光线进入物体，在物体内反弹，然后在一个与它击中的不同地方离开物体。(这被称为[次表面散射](https://en.wikipedia.org/wiki/Subsurface_scattering)）。

对所有这些相互作用进行建模是复杂的，而且非常困难。它是可以做到的，但它超出了这些基本教程的范围。我们将只讨论光如何从物体上反射。你不可能只用反射光来制作照片般逼真的图像，但在尝试更复杂的建模之前，你需要了解基础知识。

### 光源

在现实世界中，光来自于[光源](https://en.wikipedia.org/wiki/List_of_light_sources)。太阳是最明显的光源。其他光源包括灯、聚光灯、火和爆炸。光的特性根据其来源而变化。如果我们希望得到合理的效果图，我们需要对光的这些基本特性进行建模。我们将对光源的以下属性进行建模。

- 位置--光从哪里来？有两种情况：
    - 方向性--光源离得很远，所有的光线基本上都朝同一个方向传播。太阳就是一个方向性光源。
    - 位置性--光源在场景内。光线照射到物体上的角度根据它们的相对位置而变化。请注意，光线照射在单个三角形的各个顶点上的角度会有所不同。
- 颜色--例如，一个红色的聚光灯
- 点式与聚光灯--光线是向所有方向传播，还是仅限于某个特定方向，如手电筒。

因为光可以有不同的颜色，所以我们对光的建模方式与我们对表面颜色的建模方式相同，使用RGB值。红光是（1.0, 0.0, 0.0），而白光则是（1.0, 1.0, 1.0）。

### 环境反射光

有时你不知道一个场景中的光源是什么。例如，想想在一个黑暗的房间里。你可以看到东西，但你不一定知道房间里的光来自哪里。它可能是来自窗户的月亮，或来自门缝下另一个房间的灯光，或夜灯的微弱光亮。不直接来自光源，而只是在场景中跳动的光，被称为环境光。

环境光是 "背景 "光。它在所有的方向上到处反弹，没有具体的起源位置。环境光可以照亮模型的每一个面。因此，获得直射光的面孔和隐藏在直射光下的面孔都受到相同数量的环境光的照耀。

环境光的数量决定了一个场景中的整体光线。一个(0.1, 0.1, 0.1)的环境光将模拟一个黑暗的房间，而一个(0.4, 0.4, 0.4)的环境光将模拟一个明亮的房间。一个(0.2, 0.0, 0.0)的环境光将模拟一个弥漫在场景中的低强度红光。你使用的确切数值通常是基于实验结果，而不是基于场景的实际物理属性。

### 漫反射光

从物体表面反射的光量与物体表面对光源的方向有关。如果光线 "直射 "到物体表面，大部分光线就会被反射。如果光线只是 "擦过 "物体的侧面，那么反射的光线就非常少。这在图中得到了说明。

<center>
<img src='/3/diffuse_light.png' />
<p>漫反射光</p>
</center>

我们假设一个脸的表面并不是完全光滑的，当光线从表面反射出来时，它在各个方向的散射是一样的。对于漫射光来说，问题在于发生多少反射，而不是反射的方向。在物理学中，[朗伯的余弦定律](https://en.wikipedia.org/wiki/Lambert%27s_cosine_law)给了我们反射的数量。

<center>
<img src='/3/cos_function.png' />
</center>

如果我们取表面法线矢量和光线之间的余弦，这就可以得到反射光的数量。当角度为零时，cos(0)为1.0，所有的光都被反射。当角度为90度时，cos(90)为0.0，没有光被反射。如果cos()为负数，面的方向远离光源，没有光被反射。反射光的数量不是一个线性关系，你可以在图像中的余弦函数图中看到这一点。

如果你把一个表面的颜色乘以表面法线和光线之间的余弦，你会把颜色向黑色扩展。这正是我们想要的结果。当越来越少的光从一个表面上反射出来时，这个表面就会变得更黑。

### 镜面反射光

如果一个物体是光滑的，从物体表面反射出来的一些光可以直接反射到观众的眼睛里（或相机的镜头）。这就产生了一个 "镜面高光"，是光源的颜色，而不是物体的颜色，因为你实际上看到的是光源的光。图片中蓝球上的每个白色区域都是镜面高光。

<center>
<img src='/3/specular_highlight.png' />
<p>镜面高光的例子（蓝球上的白色区域</p>
</center>

镜面高光的位置是由从观察者到表面上的点的光线和光线的准确反射之间的角度决定的。表面法线是用来计算反射光线的。请研究下图:

<center>
<img src='/3/specular_highlight_rays.png'>
<p>镜面高光（反射光线与相机光线之间的角度）</p>
</center>

### WebGL 实现

WebGL中的所有照明效果都是由程序员在片段着色器中完成的。要实现上述的三种光照效果，你需要做以下工作:

- 从光源模型中获取环境光量。
- 计算表面法线矢量与光线方向的夹角。
- 将该角度的余弦乘以表面的漫反射颜色。
- 计算光线反射与摄像机方向之间的角度。
- 用这个角度的余弦乘以灯光模型的镜面色。
- 将环境色、漫反射色和镜面色相加。这就是三角形表面的这个片段的像素的颜色。

我们将在第10节和第11节介绍实施照明模型的细节。