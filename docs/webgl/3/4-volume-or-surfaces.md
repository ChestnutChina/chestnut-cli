## 体积/表面

我们已经讨论了位置和方向。现在我们需要讨论如何表示三维形状和它们在空间中所占据的面积。一个物体可能是一个立方体，一个球体，一个平面，或一个复杂的球体。物体具有无限的形式。当然，以独特的方式来描述每个物体是可能的，但这需要对每个物体采用独特的渲染算法。我们想要的是一种统一的方式来描述任何类型的物体，无论其形式有多复杂。你可能会感到惊讶，但几乎所有的渲染算法都只知道如何渲染三角形!

为什么只有三角形？

- 三角形是最简单的几何形状，它定义了一个封闭的区域。三角形有一个内部面积和一个外部面积。
- 三角形总是平面的--它总是定义了一个平面。
- 三角形将三维空间划分为三个不同的区域。三维空间的所有点都位于：1）在三角形定义的平面内；2）在平面的一侧；3）在平面的另一侧。把三角形想象成定义一张平面- 的纸。按照惯例，我们可以说三角形的一条边是正面，另一条边是背面。通过组合三角形，我们可以创造出有内部和外部的形状。
- 三角形总是凸的；三角形不可能是凹的。渲染凹形多边形比渲染凸形多边形更难。

这些属性使三角形的渲染变得直接而快速，从而使3D实时图形成为可能！"。

### 定义三角形

三角形是用我们在前几课中定义的位置和方向值来定义的。

空间中的任何3个点（位置）都定义了一个三角形--只要这3个点不在彼此的顶部或沿着一条线。你可能会认为，3个点在彼此的顶部或沿着一条线是很罕见的，但当你操作三维物体时，这些情况可能经常发生。因此，当你开发计算机图形软件时，你必须不断地测试这种情况。三个没有定义有效三角形的点被称为 "退化的情况"。退化的情况是有问题的，因为它们没有定义一个封闭的区域或将三维空间划分为三个区域。但也许更重要的是，退化的情况会导致操作三角形的数学运算失败。总结一下。

- 三角形由三个点（位置）定义。
- 退化的案例：
    - 这三点并不明显。(其中两个或三个是相同的)。
    - 这三个点位于一条直线上。

三角形的三个点定义了三条边或边界线段。这三个点是边界线段相交的位置。两个几何对象的相交点被称为顶点。建模软件将定义三角形的点称为顶点。

一个三角形有两条边：一个正面和一个背面。三角形的边所围成的面，通常被称为三角形的面。(注意，"面 "是 "脸 "的一种缩写）一个三角形有两个面。观察者一次只能看到一个面。如果观看者在三角形的正面，就能看到正面的脸。同样地，只有当观众在三角形的背面时，才可以看到背面的脸。这一点很重要，因为在一个只有一个光源的场景中，只有三角形的一边会得到光线。此外，一个三角形只有一面可以面向场景中的摄像机。对于作为较大物体一部分的三角形来说，脸部的方向可以用来确定脸部是否被摄像机看到。

三角形顶点的顺序是用来确定三角形的哪一面是正面的。如果你在看一个三角形，顶点的顺序是逆时针，那么按照惯例，你看的是三角形的正面。三角形顶点的顺序被称为绕线顺序。有两种可能的绕法，如下图所示（1）。如果一个三角形没有按照你所期望的那样被画出来，那可能是因为它的顶点的缠绕顺序是反的。

<center>
<img src='/3/winding_order.png'>
<p>三角形的绕线顺序</p>
</center>

一个平面三角形有两个重要的向量与之相关。这两个向量都与三角形内的每一个点成直角。一个向量指向远离正面的地方；另一个向量指向远离背面的地方。这些向量可以在下面的图片中看到。(2) 你可以通过取三角形任何两条边的向量交积来计算这些向量。你使用哪条边和进行交叉积的顺序决定了你计算的是哪个向量。如果一个三角形的顶点有一个逆时针的缠绕顺序，我们采取边1（顶点1和2之间）和边2（顶点2和3之间）的交叉积，你会得到指向远离正面的法向量。

<center>
<img src='/3/normal_vectors.png'>
<p>平面的法向量</p>
</center>

记住，向量没有位置，只有方向。因此，一个向量可以代表三角形表面上所有点的正面方向。

请注意以下关于三角形的方向/方位:

- 指向远离三角形正面的、与三角形表面的每一点成直角的向量称为法向量。它通常被称为法线。
- 法向量可以根据需要 "即时计算"（假设三角形的绕线顺序是正确的），也可以一次性计算并与三角形的定义一起存储。这就是典型的计算机科学的资源分配问题。如果法- 线是按需计算的，那么每次渲染三角形时，CPU（或GPU）都要做更多的工作。如果法线与三角形的定义一起存储，那么就需要更多的内存来存储每个三角形。
- 如果法线向量被预先计算并与模型一起存储，那么它总是被归一化为单位长度，因为这可以最大限度地减少重复渲染时需要的数学计算。
- 从来没有必要同时计算或存储正面和背面的法线向量，因为它们指向的方向正好相反。如果正面的法向量是<3,-2,5>，那么背面的法向量就是<-3,2,-5>。

### 定义3D对象

任何三维物体的形状都可以用一组三角形来近似，称为[三角形网格](https://en.wikipedia.org/wiki/Triangle_mesh)。**海豚**图像显示了一个例子。

<center>
<img src='/3/Dolphin_triangle_mesh.png' />
<p>一个三角形网格的例子（<a href="https://en.wikipedia.org/wiki/Triangle_mesh#/media/File:Dolphin_triangle_mesh.png" target="_blank">来源1</a>）</p>
</center>

一个物体形态的准确性取决于用于建模的三角形的数量。总是有以下的权衡：

- 使用最少的三角形，这意味着物体的形状是一个粗略的近似值，但渲染速度非常快，使用的内存非常少。
- 使用许多三角形，这意味着物体的形状是准确的，但渲染需要更多的时间，对RAM和GPU内存的要求也更高。

下面的图片显示了当你增加三角形的数量时，一个物体的形状可以更加接近了。([3](https://www.quora.com/What-is-a-mesh-in-OpenGL))

<center>
<img src='/3/triangle_mesh_quality.jpeg' />
<p>通过增加三角形来完善一个模型的形式</p>
</center>

定义一个实体物体的三角形网格，从一个特定的角度来看，只有部分三角形是可见的。如果三角形的密度在物体的整个表面上是均匀的，那么，平均来说，在任何时候，只有一半的模型的三角形是可见的。有一个简单的测试来确定一个三角形是否可见。计算指向相机视角方向的向量与三角形的法线向量之间的角度。如果这个角度大于90度，那么这个三角形的正面就远离摄像机，将不可见--它将被模型中其他朝向摄像机的三角形所隐藏。两个向量之间的角度可以通过取它们的点积来计算。这个简单的测试被称为[脸部剔除](https://www.opengl.org/wiki/Face_Culling)，有可能使渲染速度提高两倍。

请注意，面剔除只能在实体物体的模型上进行。如果一个模型没有完全包围住模型的内部，那么有时从其背面可见的三角形将不能被正确渲染。

### WebGL 三角形渲染模式

在WebGL中，您总是使用一个顶点数组来定义一组三角形。如下图所示，有三种不同的方式可以使用顶点来形成三角形。这些选项是：
- **TRIANGLES** - 每个三角形有三个顶点。每个顶点用于一个三角形。用于多个三角形的顶点必须在顶点阵列中重复。定义n个三角形需要3n个顶点。
- **TRIANGLE_STRIP** - 在最初的三个顶点之后，每增加一个顶点就多定义一个三角形。定义n个三角形需要（n+2）个顶点。
- **TRIANGLE_FAN** - 所有三角形共享第一个顶点。在前两个顶点之后，每一个新的顶点都会再创建一个三角形。定义n个三角形需要（n + 2）个顶点。

<center>
<img src='/3/triangle_drawing_modes2.png' />
<p>WebGL 三角形绘制模式(<a href='https://www.informit.com/articles/article.aspx?p=2111395&seqNum=2' target='_blank'>4</a>)</p>
</center>

将一个三角形网格分成最有效的**TRIANGLES**、**TRIANGLE_STRIP**和**TRIANGLE_FAN**组是一个非常困难的问题。你可以通过使用**TRIANGLE_STRIP**，和**TRIANGLE_FAN**模式来节省相当多的内存，但它们实际上很少被使用。让我们考虑一个非常简单的例子。一个立方体由8个顶点和12个三角形定义（6条边，每边2个三角形）。这里有很多方法可以渲染这个立方体，比如说：

- 对所有三角形使用**TRIANGLES**模式。这需要一个36个顶点的阵列（12个三角形*3个顶点/三角形）。
- 使用2个数组和**TRIANGLE_FAN**模式。一个扇形将从左下角开始；另一个扇形将从右上角开始。每个扇形将绘制6个三角形。这需要两个各有8个顶点的数组，总共16个顶点。
- 使用**TRIANGLE_STRIP**模式来画出前面、右边、后面和左边。然后使用2个**TRIANGLE_FAN**模式：一个用于上面的两个面，一个用于下面的两个面。这需要一个包含10个顶点的**TRIANGLE_STRIP**数组，以及2个用于顶部和底部的数组，每个数组包含4个顶点。这总共是18个顶点。
- 等等。(许多其他的组合都是可能的）。

三角形组的优化以最小化内存需求超出了本教程的范围。我们将限制自己在所有的渲染中使用**TRIANGLES**模式 - 以使用更多的RAM和GPU内存为代价。



