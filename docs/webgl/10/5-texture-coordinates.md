## 纹理坐标

纹理映射最具挑战性的部分是将纹理坐标分配给模型的顶点。 Blender 有一套丰富的工具来完成这项任务。事实上，它拥有的工具和技术比我们在一堂课中可能涵盖的要多。我们将讨论基础知识，您可以自己追求更高级的技术。

纹理映射的典型目标是以覆盖整个模型的方式将图像包裹在对象周围，并且模型的各个三角形不明显。但其他情况也是可能的。如果需要，您可以对单个面或面组进行纹理处理。但是，请记住，使用不同纹理贴图渲染单个面通常需要单独渲染每个面，这会大大降低渲染速度。

### 纹理映射基本图元

Blender 具有适用于所有基本网格图元的内置纹理映射功能。因此，如果您只想将图像包裹在三角形网格周围，那么过程是：

- 选择一个模型。
- 进入“编辑模式”。 （标签键）
- 点击“a”键，直到所有面都被选中。
- 在属性面板中，选择“材料”面板。
- 创建一个新材料并为其命名。
- 将材质“分配”到模型的面部。 （执行此操作时应选择所有面！）
- 材料仍然是“活动材料”，选择纹理属性面板。
- 创建一个新纹理并为其命名。
- 在“类型”下拉框中，选择“图像或电影”。
- 在“图像”部分中，选择“打开”，这会打开一个文件浏览器。导航到您要使用的文件并选择它。始终将纹理贴图文件保存在与使用它们的模型相同的文件夹中。这允许 Blender 在没有文件路径的情况下找到文件。
- 在“映射”部分
    - 对于“坐标：”下拉菜单，选择“生成”选项。这意味着 Blender 将自动生成纹理坐标。
    - 对于“投影：”下拉菜单，选择纹理映射的基元类型（例如，平面、立方体、管或球体） 
        - flat：整个图像用于四边形或三角形。如果图像的纵横比与 3D 表面的纵横比不同，则图像将失真。
        - 立方体：整个图像用于立方体的 6 个面。
        - 管：整个图像被包裹在模型周围（假设它是一个圆环）。
        - 球体：整个图像被包裹在模型周围（假设它是一个球体）。
    - 请注意，在“flat”和“cube”生成纹理坐标的情况下，图像被重复用于每个“side”，而“tube”和“sphere”生成的纹理坐标使用图像的单个副本并将其包裹起来整个模型。

您可以通过在 Blender 中渲染模型或导出 OBJ 文件并查找以“vt”（顶点纹理坐标）开头的行来验证模型是否具有纹理坐标。

以下 [5 分钟视频](https://www.youtube.com/watch?v=V3anjjy8_O0)演示了上述步骤。

### UV 纹理映射

在许多情况下，您希望对纹理坐标的分配进行比上述“生成”值更多的控制。这是使用“UV 纹理映射”工具完成的。基本思想是，您采用 3D 模型并选择可以“切割”的边缘以将模型展开到平面上。然后将展开的面放在纹理贴图图像的顶部并根据需要排列它们。这使您可以完全控制每个顶点的纹理坐标。

#### UV 纹理映射
OpenGL 和 WebGL 使用字母 s 和 t 描述纹理映射的轴，但在“过去”中，轴被称为 u 和 v*。术语“UV 纹理映射”是“旧时代”的“保留”。

执行 UV 纹理映射的步骤与上述相同：

- 选择一个模型。
- 进入“编辑模式”。 （标签键）
- 点击“a”键，直到所有面都被选中。
- 在属性面板中，选择“材料”面板。
- 创建一个新材料并为其命名。
- 将材质“分配”到模型的面部。 （确保所有面都被选中。）
- 材料仍然是“活动材料”，选择纹理属性面板。
- 创建一个新纹理并为其命名。
- 在“类型”下拉框中，选择“图像或电影”。
- 在“图像”部分中，选择“打开”，这会打开文件浏览器。然后选择您的图像。
- 在“映射”部分中，对于“坐标：”下拉菜单，选择“UV”选项。这意味着您将使用“UV/图像编辑器”设置纹理坐标。

您现在为每个顶点分配了纹理坐标，但没有您可能想要的纹理坐标。您需要转换模型的面，使它们位于纹理图像的正确部分上。要设置此任务，请执行以下操作：

- 将窗口面板配置更改为“UV 编辑”模式。这将允许您查看 3D 模型和“UV/图像编辑器”。
- 在“浏览要链接的图像”下拉菜单中选择纹理贴图图像。这将在“UV/图像编辑器”中显示图像。
- 同样在“UV/图像编辑器”的菜单选项中，启用“保持 UV 和编辑模式网格选择同步”选项。这允许您在“3D 视图”或“UV/图像编辑器”窗口中选择顶点、边或面，并且将在另一个窗口中选择相应的元素。
- 在“3D 视图”窗口中，将显示模式更改为“纹理”。这使您可以在模型的表面上看到纹理图像。

现在您已准备好编辑纹理坐标。按着这些次序：

- 在“3D 视图”窗口中，在编辑模式下，更改为“边缘选择”模式。
- 选择可以“切割”的边缘以将模型展开到平面上。
- 调出边缘菜单（CRTL-E）并选择“标记接缝”。
- 将光标放在“3D 视图”窗口中并选择所有面，点击“u”键。在弹出菜单中选择“解包”命令。这会在您选择的接缝处“切割”模型面，并将模型的面放在纹理图像上。如果您没有看到“UV/图像编辑器”中显示的面，最可能的原因是无法使用您为接缝选择的边展开模型。请注意，“UV/图像编辑器”中的某些面可能彼此重叠。当多个面使用纹理图像的同一部分时会发生这种情况。
- 使用正常的编辑命令，例如“g”用于抓取、“s”用于缩放、“r”用于旋转、“b”用于框选择等，将面顶点移动到纹理图像的所需部分上。如果扭曲任何三角形（或四边形）的形状，生成的纹理贴图也会扭曲。

如果您不喜欢您的任何决定，您始终可以通过选择模型的所有边缘、清除边缘接缝（CRTL-E，“清除接缝”）、选择要切割的新边缘以“展开”来重新启动该过程模型，然后再次“展开”模型。

以下 [7 分钟视频](https://www.youtube.com/watch?v=O58gI-Rckgo)演示了上述步骤。

### 纹理映射数据

纹理映射所需的数据存储在您的 OBJ 和 MTL 模型文件中。以下示例显示了多维数据集的数据。纹理坐标位于以“vt”开头的行上。这些值隐式定义了一组纹理坐标，这些坐标从 1 开始索引。稍后在文件中定义面时，每个顶点都具有来自已定义顶点的几何坐标 (x,y,z)，以及来自已定义纹理坐标的 (s,t) 值。语法 5/2 定义了使用第 5 个 (x,y,z) 值和第 2 个 (s,t) 值的顶点。请注意，单个几何和纹理坐标用于多个面。

```js
# Blender v2.73 (sub 0) OBJ File: 'textured_cube_faces.blend'
# www.blender.org
mtllib textured_cube_faces.mtl
o Cube
v 1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 -1.000000 -1.000000
v 1.000000 1.000000 -0.999999
v 0.999999 1.000000 1.000001
v -1.000000 1.000000 1.000000
v -1.000000 1.000000 -1.000000
vt 0.000000 0.000000
vt 1.000000 0.000000
vt 1.000000 1.000000
vt 0.000000 1.000000
usemtl Material
s off
f 1/1 2/2 3/3 4/4
f 5/1 8/2 7/3 6/4
f 1/1 5/2 6/3 2/4
f 2/1 6/2 7/3 3/4
f 3/1 7/2 8/3 4/4
f 5/1 1/2 4/3 8/4
```

“材质定义”文件 MTL 将纹理贴图的文件名存储在材质的 map_Kd 属性中。这是一个示例 MTL 文件：
```js
# Blender MTL File: 'textured_cube.blend'
# Material Count: 1

newmtl cube_material
Ns 96.078431
Ka 1.000000 1.000000 1.000000
Kd 0.640000 0.640000 0.640000
Ks 0.500000 0.500000 0.500000
Ke 0.000000 0.000000 0.000000
Ni 1.000000
d 1.000000
illum 2
map_Kd texture1.png
```

### 创建/计算纹理坐标的其他方法

纹理坐标指定可以从中检索颜色的位置。对于基于图像的纹理映射，位置是 2D 图像中的位置。对于您将在下一课中学习的基于程序的纹理映射，纹理坐标指定计算图案内的位置。可以使用模型的几何形状 (x,y,z) 顶点作为纹理坐标。考虑以下场景：

- 在 (0,0,0) 到 (1,1,1) 范围内的单位立方体内定义模型。 （模型始终可以缩放到渲染所需的任何大小。）对于每个顶点 (x,y,z)，使用 (x,y) 值作为 (s,t) 纹理坐标。请注意，如果 x 或 y 在曲面上没有变化，则此方法效果不佳。
- 在 (0,0,0) 到 (1,1,1) 范围内的单位立方体内定义模型。对于每个顶点 (x,y,z)，使用 (x,y)、(x,z) 或 (y,z) 作为您的 (s,t) 纹理坐标，具体取决于顶点法线向量的方向。例如，如果法向量指向 Z 或 -Z 方向，则使用 (x,y)，如果法向量指向 X 或 -X 方向，则使用 (y,z)，或者如果法向量指向指向 Y 或 -Y 方向，使用 (x,z)。 （或者您可以区分并使用 (x,z) 表示 +Y 和 (z,x) 表示 -Y。）
- 使用任何合适的单位定义您的模型，但在将顶点用于 (s,t) 坐标之前，将顶点缩放到片段着色器中的范围 (0.0, 1.0)。根据您定义模型的方式，您可能必须向片段着色器传递模型几何的最小和最大限制。

### 总结

我们只讨论了 Blender 的一些纹理坐标编辑工具。如果您对更高级的技术感兴趣，请在网络上搜索相关视频教程。[纹理映射的 Blender 文档](https://www.blender.org/manual/render/blender_render/textures/index.html)也是一个很好的参考。请注意，Blender 具有三种不同的渲染算法（Blender Render、Blender Game 和 Cycles Render），每种算法使用不同类型的材质属性。因此，对于三种不同的渲染算法，您创建和修改纹理的方式是不同的！上面的说明使用默认的 Blender 渲染算法。