## 纹理贴图的变换

纹理坐标通常是为模型定义的，从不修改。这允许模型的表面属性保持静态，即使在模型的几何形状在位置、方向和比例上发生变化时也是如此。但
有时您希望纹理在面的表面上移动，例如代表海洋中水的表面。由于风和其他力量，水不断移动。那么我们如何移动纹理贴图呢？很简单，我们移动定义其位置的纹理坐标。

本课介绍纹理贴图变换背后的基本思想。

### 概述

| 转换 | 转换矩阵 |
| -- | -- |
| 平移 | $\begin{bmatrix} 1.0 & 0.0 & tx \\ 0.0 & 1.0 & ty \\ 0.0 & 0.0 & 1.0 \end{bmatrix}$ |
| 旋转 | $\begin{bmatrix} cos(angle) & -sin(angle) & 0.0 \\ sin(angle) & cos(angle) & 0.0 \\ 0.0 & 0.0 & 1.0 \end{bmatrix}$ |
| 缩放 | $\begin{bmatrix} sx & 0.0 & 0.0 \\ 0.0 & sy & 0.0 \\ 0.0 & 0.0 & 1.0 \end{bmatrix}$ |

我们需要一个能够创建 3×3 转换矩阵并对其执行数学运算的 JavaScript 库。下面演示程序中的文件 Learn_webgl_matrix3.js 包含所需的功能。 （使用 Chrome 的“开发工具”查看或保存副本。）

在 GLSL 语言中，mat3 数据类型包含一个 3×3 矩阵变换。 WebGL 中的所有矩阵都存储为按列优先顺序组织的一维数组。

如果我们要通过改变纹理坐标来移动纹理贴图，我们最好使用可以在表面上重复的“平铺”图像。我们将纹理贴图模式设置为 gl.REPEAT，以便在 0.0 到 1.0 范围之外转换的纹理坐标映射到纹理图像中的有效位置。右侧的 256x256 图像是“可平铺”图像。

<center>
  <img src="/10/water.png" />
  <p>
    <a href="http://www.rendertextures.com/seamless-water-13/" target="_blank">“平铺”纹理图像</a>
  </p>
</center>

### 实验

当您尝试下面的演示程序时，请注意以下几点：

- 模型的纹理坐标存储在 GPU 内存中的缓冲区对象中，并且该数据永远不会改变。每次渲染模型时，都会在着色器程序中将纹理映射变换矩阵设置为统一变量。模型的每个纹理坐标都与顶点着色器中的这个 3×3 变换相乘。数据是静态的；正在改变的是转变。
- 在顶点着色器中，当您将 (s,t) 纹理坐标乘以 3×3 变换矩阵时，您必须将 (s,t) 值更改为 (s,t,1)。 1 的附加分量是二维坐标的“齐次坐标”。请记住，第三个位置的 1 实现了转换的平移部分。
- 对于立方体，不可能以不产生可见“接缝”的方式对齐立方体的六个边。但是，对于更复杂的模型，您通常可以让模型一侧的所有边缘对齐，然后“隐藏”任何未对齐模型背面或底部的接缝。

点击查看[交互式例子](http://learnwebgl.brown37.net/10_surface_properties/texture_mapping_transforms.html#experimentation)

[在新的标签或窗口中打开这个webgl程序](http://learnwebgl.brown37.net/10_surface_properties/texture_transform/texture_transform.html)


### 总结

在面部表面移动纹理贴图很简单，并且使用我们之前研究过的相同转换工具。此外，转换是在顶点着色器中执行的，因此对渲染速度的影响非常小。
