## 结合光和表面属性

哇！我们已经介绍了许多与表面特性相关的技术。而我们只触及了可能的表面！ （双关语！）

为了结束我们对表面属性的讨论，我们需要将它们与光照计算结合起来。一般来说，片段着色器将：

- 确定片段的颜色，
- 设置片段的法线向量以进行光照计算，以及
- 根据光照计算修改颜色。

这些步骤中的每一个都可以是简单的或复杂的。每个步骤可以涉及一种方法或方法的组合。您的创意想法没有限制！例如，要为片段创建颜色，您可以将三角形的颜色属性与图像纹理贴图中的颜色和另一种颜色的某个百分比相结合，其中百分比是使用程序纹理贴图计算的。要组合这些颜色，您可以从无数可能的百分比中进行选择，例如 1/3、1/3、1/3 或 1/2、1/4、1/4 或 3/4、3/16 , 1/16。你明白了。事实上，几乎所有的特殊效果都是通过组合来自多个来源的颜色来创建的。除了颜色选择之外，照明计算可能会很复杂，尤其是在有多个不同类型的光源的情况下。

本课介绍了一个非常简单的表面属性和光反射相互作用的示例。希望您能够将该示例推断为无限多的可能性。

### 实验计划

下面的 WebGL 程序创建了两个不同的着色器程序，一个用于渲染场景中的立方体，另一个用于渲染块字母。两个着色器程序使用相同的顶点着色器，但使用不同的片段着色器。在您尝试 WebGL 程序之前，让我们回顾一下每个着色器的细节。

渲染立方体的片段着色器 shader38.frag 执行以下操作:

- 使用程序纹理贴图计算百分比值。 （参见函数 my_texture。）
- 使用百分比，使用模型的表面颜色和白色计算渐变颜色。
- 归一化曲面法线，因为它是在曲面上插值的。
- 对颜色执行光照计算。
- 将颜色输出到 gl_FragColor

渲染字母的片段着色器 shader39.frag 执行以下操作：

- 从图像纹理贴图 (water.png) 中获取颜色。
- 创建一种颜色，该颜色是纹理贴图颜色的一半和面颜色的一半。
- 归一化曲面法线，因为它是在曲面上插值的。
- 对颜色执行光照计算。
- 将颜色输出到 gl_FragColor

特别注意下面的 surface_and_light_render.js 代码中的以下内容：

- 在第 383-384 行中，创建了两个着色器程序：cube_program 和 text_program。
- 在第 393-396 行中，立方体的模型是使用 cube_program 着色器创建的。
- 在第 398-400 行中，字母的模型是使用 text_program 着色器创建的。
- 当场景在右侧画布中渲染时
    - 在第 238 行，gl2.useProgram() 函数用于激活 cube_program。这允许使用程序纹理贴图来渲染所有立方体（第 255-258 行）。
    - 在第 262 行，gl2.useProgram() 函数用于激活 text_program。这允许使用图像纹理映射（第 255-258 行）渲染所有字母。
- 光照数据必须两次传入着色器，每个着色器程序一次。这在 cube_program 着色器的第 244-249 行和 text_program 着色器的第 265-270 行中完成。

请尝试下面的 WebGL 程序并研究代码。

点击查看[交互式例子](http://learnwebgl.brown37.net/10_surface_properties/combining_light_and_surface_properties.html#experimentation-program)

[在新的标签或窗口中打开这个webgl程序](http://learnwebgl.brown37.net/10_surface_properties/surface_and_light/surface_and_light.html)

### 总结

渲染对象的最终外观是面部表面属性和光照计算的交互。通过特别小心，您可以开发顶点着色器和片段着色器，以产生照片般逼真的渲染和惊人的视觉效果。