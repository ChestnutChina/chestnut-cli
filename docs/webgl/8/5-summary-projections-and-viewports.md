## 投影和视口的总结

这套关于投影和视口的课程，以及之前关于相机和模型转换的课程，广泛使用了4乘4的转换矩阵。掌握4乘4变换矩阵的使用是学习如何创建三维计算机图形的基础。

本课将我们在第6、7和8节中讨论的所有内容纳入视野（没有双关的意思）。

### 图形管道回顾

要了解计算机图形，你必须了解图形管道。让我们再次回顾一下图形管道。

![](/8/pipeline_with_clipping.png)

你有一组你想渲染的模型来组成一个虚拟场景。这些模型包含两种基本类型的数据:

1. 由顶点（x,y,z）和法向量\<dx,dy,dz>组成的几何数据，以及
2. 材料属性数据，如颜色、纹理坐标、光泽度系数等。

这些数据通过图形管道来创建一个场景的2D图像。该管道的前半部分处理几何数据，而后半部分处理材料属性数据。

在前三个阶段：
1. 几何数据使用一个4乘4的转换矩阵进行转换，以将模型的几何图形放置在其所需的位置、方向和尺寸。这被称为 "模型转换"。
2. 几何数据使用一个4乘4的变换矩阵进行转换，以将场景置于摄像机前面。这被称为 "视图变换"（或 "摄像机变换"）。
3. 几何数据被投射到一个二维观察窗口。这被称为 "投射变换"。

所有这些转换都发生在顶点着色器程序中。你在一个JavaScript程序中创建所需的变换矩阵，而在GPU上运行的顶点着色器程序则执行实际的几何数据变换。大多数WebGL程序将所有这些变换组合成一个4乘4的变换矩阵，其中从右到左的排序至关重要，因为模型变换必须首先发生，然后是视图变换，最后是投影变换。在矩阵格式中，你的JavaScript程序会创建。

```html
                  ┌                  ┐   ┌            ┐   ┌              ┐ Eq1
VertexTransform = │ ProjectionMatrix │ * | ViewMatrix | * |  ModelMatrix |
                  └                  ┘   └            ┘   └              ┘
```

你的几何数据已经被转化为剪切体积--一个以原点为中心的2x2x2立方体。所有在这个立方体之外的几何体都被剪掉了。现在，管道开始创建一个二维图像，将顶点映射到一个像素的二维阵列中，其大小与相关的HTML画布元素相同。这被称为 "视口转换"。

几何数据现在被定位在正确的位置，以创建一个二维图像。但是，所有这些转换都只是在构成模型的点、线和三角形的顶点上进行。构成原始对象的所有像素还没有被确定。这就是管道中的下一步，它被称为 "光栅化"（或栅格化）阶段。

### 光栅化

光栅化意味着将几何对象的基于矢量的描述转换为一组像素。例如，如果我们知道定义三角形的三个顶点的像素位置，栅格化三角形意味着我们确定哪些像素位于三角形的顶点和边缘形成的边界内。管道的光栅化阶段是自动完成的。

对于每个用于构成原始对象的像素，都会创建一个 "片段"。一个片段知道它的像素位置和其他可能需要为像素分配颜色的信息。每个被创建的 "片段 "都被传递给在GPU上执行的片段着色器。片段着色器程序进行计算，为其像素分配一个适当的颜色。

这些教程的其余部分将讨论片段着色器如何计算一个像素的颜色。